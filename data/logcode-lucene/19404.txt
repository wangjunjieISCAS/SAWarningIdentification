GitDiffStart: 151fd05016d241d4b0164da5c1ed8e6886fb8e90 | Thu Sep 10 02:44:50 2009 +0000
diff --git a/contrib/queryparser/src/java/org/apache/lucene/messages/Message.java b/contrib/queryparser/src/java/org/apache/lucene/messages/Message.java
deleted file mode 100644
index f56f579..0000000
--- a/contrib/queryparser/src/java/org/apache/lucene/messages/Message.java
+++ /dev/null
@@ -1,37 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-import java.io.Serializable;
-import java.util.Locale;
-
-/**
- * Message Interface for a lazy loading.
- * For Native Language Support (NLS), system of software internationalization.
- */
-public interface Message extends Serializable {
-
-  public String getKey();
-
-  public Object[] getArguments();
-
-  public String getLocalizedMessage();
-
-  public String getLocalizedMessage(Locale locale);
-
-}
diff --git a/contrib/queryparser/src/java/org/apache/lucene/messages/MessageImpl.java b/contrib/queryparser/src/java/org/apache/lucene/messages/MessageImpl.java
deleted file mode 100644
index cf9e520..0000000
--- a/contrib/queryparser/src/java/org/apache/lucene/messages/MessageImpl.java
+++ /dev/null
@@ -1,71 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-import java.util.Locale;
-
-/**
- * Default implementation of Message interface.
- * For Native Language Support (NLS), system of software internationalization.
- */
-public class MessageImpl implements Message {
-
-  private static final long serialVersionUID = -3077643314630884523L;
-
-  private String key;
-
-  private Object[] arguments = new Object[0];
-
-  public MessageImpl(String key) {
-    this.key = key;
-
-  }
-
-  public MessageImpl(String key, Object... args) {
-    this(key);
-    this.arguments = args;
-  }
-
-  public Object[] getArguments() {
-    return this.arguments;
-  }
-
-  public String getKey() {
-    return this.key;
-  }
-
-  public String getLocalizedMessage() {
-    return getLocalizedMessage(Locale.getDefault());
-  }
-
-  public String getLocalizedMessage(Locale locale) {
-    return NLS.getLocalizedMessage(getKey(), locale, getArguments());
-  }
-
-  public String toString() {
-    Object[] args = getArguments();
-    String argsString = "";
-    if (args != null) {
-      for (int i = 0; i < args.length; i++) {
-        argsString += args[i] + (i < args.length ? "" : ", ");
-      }
-    }
-    return getKey() + " " + argsString;
-  }
-
-}
diff --git a/contrib/queryparser/src/java/org/apache/lucene/messages/NLS.java b/contrib/queryparser/src/java/org/apache/lucene/messages/NLS.java
deleted file mode 100644
index 1cf9ab3..0000000
--- a/contrib/queryparser/src/java/org/apache/lucene/messages/NLS.java
+++ /dev/null
@@ -1,208 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-import java.lang.reflect.Field;
-import java.lang.reflect.Modifier;
-import java.security.AccessController;
-import java.security.PrivilegedAction;
-import java.text.MessageFormat;
-import java.util.HashMap;
-import java.util.Iterator;
-import java.util.Locale;
-import java.util.Map;
-import java.util.MissingResourceException;
-import java.util.ResourceBundle;
-
-/**
- * MessageBundles classes extend this class, to implement a bundle.
- * 
- * For Native Language Support (NLS), system of software internationalization.
- * 
- * This interface is similar to the NLS class in eclipse.osgi.util.NLS class -
- * initializeMessages() method resets the values of all static strings, should
- * only be called by classes that extend from NLS (see TestMessages.java for
- * reference) - performs validation of all message in a bundle, at class load
- * time - performs per message validation at runtime - see NLSTest.java for
- * usage reference
- * 
- * MessageBundle classes may subclass this type.
- */
-public class NLS {
-
-  private static Map<String, Class<Object>> bundles = new HashMap<String, Class<Object>>(
-      0);
-
-  protected NLS() {
-    // Do not instantiate
-  }
-
-  public static String getLocalizedMessage(String key) {
-    return getLocalizedMessage(key, Locale.getDefault());
-  }
-
-  public static String getLocalizedMessage(String key, Locale locale) {
-    Object message = getResourceBundleObject(key, locale);
-    if (message == null) {
-      return "Message with key:" + key + " and locale: " + locale
-          + " not found.";
-    }
-    return message.toString();
-  }
-
-  public static String getLocalizedMessage(String key, Locale locale,
-      Object... args) {
-    String str = getLocalizedMessage(key, locale);
-
-    if (args.length > 0) {
-      str = MessageFormat.format(str, args);
-    }
-
-    return str;
-  }
-
-  public static String getLocalizedMessage(String key, Object... args) {
-    return getLocalizedMessage(key, Locale.getDefault(), args);
-  }
-
-  /**
-   * Initialize a given class with the message bundle Keys Should be called from
-   * a class that extends NLS in a static block at class load time.
-   * 
-   * @param bundleName
-   *          Property file with that contains the message bundle
-   * @param clazz
-   *          where constants will reside
-   */
-  @SuppressWarnings("unchecked")
-  protected static void initializeMessages(String bundleName, Class clazz) {
-    try {
-      load(clazz);
-      if (!bundles.containsKey(bundleName))
-        bundles.put(bundleName, clazz);
-    } catch (Throwable e) {
-      // ignore all errors and exceptions
-      // because this function is supposed to be called at class load time.
-    }
-  }
-
-  private static Object getResourceBundleObject(String messageKey, Locale locale) {
-
-    // slow resource checking
-    // need to loop thru all registered resource bundles
-    for (Iterator<String> it = bundles.keySet().iterator(); it.hasNext();) {
-      Class<Object> clazz = bundles.get(it.next());
-      ResourceBundle resourceBundle = ResourceBundle.getBundle(clazz.getName(),
-          locale);
-      if (resourceBundle != null) {
-        try {
-          Object obj = resourceBundle.getObject(messageKey);
-          if (obj != null)
-            return obj;
-        } catch (MissingResourceException e) {
-          // just continue it might be on the next resource bundle
-        }
-      }
-    }
-    // if resource is not found
-    return null;
-  }
-
-  /**
-   * @param clazz
-   */
-  private static void load(Class<Object> clazz) {
-    final Field[] fieldArray = clazz.getDeclaredFields();
-
-    boolean isFieldAccessible = (clazz.getModifiers() & Modifier.PUBLIC) != 0;
-
-    // build a map of field names to Field objects
-    final int len = fieldArray.length;
-    Map<String, Field> fields = new HashMap<String, Field>(len * 2);
-    for (int i = 0; i < len; i++) {
-      fields.put(fieldArray[i].getName(), fieldArray[i]);
-      loadfieldValue(fieldArray[i], isFieldAccessible, clazz);
-    }
-  }
-
-  /**
-   * @param field
-   * @param isFieldAccessible
-   */
-  private static void loadfieldValue(Field field, boolean isFieldAccessible,
-      Class<Object> clazz) {
-    int MOD_EXPECTED = Modifier.PUBLIC | Modifier.STATIC;
-    int MOD_MASK = MOD_EXPECTED | Modifier.FINAL;
-    if ((field.getModifiers() & MOD_MASK) != MOD_EXPECTED)
-      return;
-
-    // Set a value for this empty field.
-    if (!isFieldAccessible)
-      makeAccessible(field);
-    try {
-      field.set(null, field.getName());
-      validateMessage(field.getName(), clazz);
-    } catch (IllegalArgumentException e) {
-      // should not happen
-    } catch (IllegalAccessException e) {
-      // should not happen
-    }
-  }
-
-  /**
-   * @param key
-   *          - Message Key
-   */
-  private static void validateMessage(String key, Class<Object> clazz) {
-    // Test if the message is present in the resource bundle
-    try {
-      ResourceBundle resourceBundle = ResourceBundle.getBundle(clazz.getName(),
-          Locale.getDefault());
-      if (resourceBundle != null) {
-        Object obj = resourceBundle.getObject(key);
-        if (obj == null)
-          System.err.println("WARN: Message with key:" + key + " and locale: "
-              + Locale.getDefault() + " not found.");
-      }
-    } catch (MissingResourceException e) {
-      System.err.println("WARN: Message with key:" + key + " and locale: "
-          + Locale.getDefault() + " not found.");
-    } catch (Throwable e) {
-      // ignore all other errors and exceptions
-      // since this code is just a test to see if the message is present on the
-      // system
-    }
-  }
-
-  /*
-   * Make a class field accessible
-   */
-  @SuppressWarnings("unchecked")
-  private static void makeAccessible(final Field field) {
-    if (System.getSecurityManager() == null) {
-      field.setAccessible(true);
-    } else {
-      AccessController.doPrivileged(new PrivilegedAction() {
-        public Object run() {
-          field.setAccessible(true);
-          return null;
-        }
-      });
-    }
-  }
-}
diff --git a/contrib/queryparser/src/java/org/apache/lucene/messages/NLSException.java b/contrib/queryparser/src/java/org/apache/lucene/messages/NLSException.java
deleted file mode 100644
index 0c6b904..0000000
--- a/contrib/queryparser/src/java/org/apache/lucene/messages/NLSException.java
+++ /dev/null
@@ -1,34 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-/**
- * Interface that exceptions should implement to support lazy loading of messages.
- * 
- * For Native Language Support (NLS), system of software internationalization.
- * 
- * This Interface should be implemented by all exceptions that require
- * translation
- * 
- */
-public interface NLSException {
-  /**
-   * @return a instance of a class that implements the Message interface
-   */
-  public Message getMessageObject();
-}
diff --git a/contrib/queryparser/src/java/org/apache/lucene/messages/package.html b/contrib/queryparser/src/java/org/apache/lucene/messages/package.html
deleted file mode 100644
index 14219e8..0000000
--- a/contrib/queryparser/src/java/org/apache/lucene/messages/package.html
+++ /dev/null
@@ -1,99 +0,0 @@
-<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
-<!--
- Licensed to the Apache Software Foundation (ASF) under one or more
- contributor license agreements.  See the NOTICE file distributed with
- this work for additional information regarding copyright ownership.
- The ASF licenses this file to You under the Apache License, Version 2.0
- (the "License"); you may not use this file except in compliance with
- the License.  You may obtain a copy of the License at
-
-     http://www.apache.org/licenses/LICENSE-2.0
-
- Unless required by applicable law or agreed to in writing, software
- distributed under the License is distributed on an "AS IS" BASIS,
- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- See the License for the specific language governing permissions and
- limitations under the License.
--->
-<html>
-<head>
-   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
-</head>
-<body>
-
-For Native Language Support (NLS), system of software internationalization.
-
-<h2>NLS message API</h2>
-<p>
-This utility API, adds support for NLS messages in the apache code.
-It is currently used by the lucene "New Flexible Query PArser".
-</p>
-<p>
-Features:
-    <ol>
-        <li>Message reference in the code, using static Strings</li>
-        <li>Message resource validation at class load time, for easier debugging</li>
-        <li>Allows for message IDs to be re-factored using eclipse or other code re-factor tools</li>
-        <li>Allows for reference count on messages, just like code</li>
-		<li>Lazy loading of Message Strings</li>        
-        <li>Normal loading Message Strings</li>                  
-    </ol>
-</p>
-
-<br/>
-<br/>
-<p>
-Lazy loading of Message Strings
-
-<pre>
-	public class MessagesTestBundle extends NLS {
-	
-	  private static final String BUNDLE_NAME = MessagesTestBundle.class.getName();
-	
-	  private MessagesTestBundle() {
-	    // should never be instantiated
-	  }
-	
-	  static {
-	    // register all string ids with NLS class and initialize static string
-	    // values
-	    NLS.initializeMessages(BUNDLE_NAME, MessagesTestBundle.class);
-	  }
-	
-	  // static string must match the strings in the property files.
-	  public static String Q0001E_INVALID_SYNTAX;
-	  public static String Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION;
-	
-	  // this message is missing from the properties file
-	  public static String Q0005E_MESSAGE_NOT_IN_BUNDLE;
-	}
-
-    // Create a message reference
-    Message invalidSyntax = new MessageImpl(MessagesTestBundle.Q0001E_INVALID_SYNTAX, "XXX");
-    
-    // Do other stuff in the code...
-    // when is time to display the message to the user or log the message on a file
-    // the message is loaded from the correct bundle
-    
-    String message1 = invalidSyntax.getLocalizedMessage();
-    String message2 = invalidSyntax.getLocalizedMessage(Locale.JAPANESE);
-</pre>
-</p>
-
-<br/>
-<br/>
-<p>
-Normal loading of Message Strings
-
-<pre>
-	String message1 = NLS.getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION);
-	String message2 = NLS.getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION, Locale.JAPANESE);
-</pre>
-</p>
-
-<p>
-The org.apache.lucene.messages.TestNLS junit contains several other examples.
-The TestNLS java code is available from the Apache Lucene code repository.
-</p>
-</body>
-</html>
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/QueryNodeParseException.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/QueryNodeParseException.java
index c60f657..96ff434 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/QueryNodeParseException.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/QueryNodeParseException.java
@@ -58,7 +58,7 @@ public class QueryNodeParseException extends QueryNodeException {
   public void setQuery(CharSequence query) {
     this.query = query;
     this.message = new MessageImpl(
-        QueryParserMessages.INVALID_SYNTAX_CANNOT_PARSE, query, "");
+        QueryParserMessages.INVALID_SYNTAX_CANNOT_PARSE, new Object[] {query, ""});
   }
 
   public CharSequence getQuery() {
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/builders/QueryTreeBuilder.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/builders/QueryTreeBuilder.java
index 9cae3ac..bf521a1 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/builders/QueryTreeBuilder.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/builders/QueryTreeBuilder.java
@@ -175,9 +175,9 @@ public class QueryTreeBuilder implements QueryBuilder {
     if (builder == null) {
 
       throw new QueryNodeException(new MessageImpl(
-          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, node
+          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, new Object[]{node
               .toQueryString(new EscapeQuerySyntaxImpl()), node.getClass()
-              .getName()));
+              .getName()}));
 
     }
 
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/BoostQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/BoostQueryNode.java
index 125d253..63880f5 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/BoostQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/BoostQueryNode.java
@@ -51,7 +51,7 @@ public class BoostQueryNode extends QueryNodeImpl {
   public BoostQueryNode(QueryNode query, float value) throws QueryNodeException {
     if (query == null) {
       throw new QueryNodeError(new MessageImpl(
-          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, "query", "null"));
+          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, new Object[]{"query", "null"}));
     }
 
     this.value = value;
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/GroupQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/GroupQueryNode.java
index 14ae263..a8a4e9b 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/GroupQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/GroupQueryNode.java
@@ -42,7 +42,7 @@ public class GroupQueryNode extends QueryNodeImpl {
   public GroupQueryNode(QueryNode query) {
     if (query == null) {
       throw new QueryNodeError(new MessageImpl(
-          QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, "query", "null"));
+          QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, new Object[]{"query", "null"}));
     }
 
     allocate();
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ModifierQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ModifierQueryNode.java
index 9faff8d..ecabf99 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ModifierQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ModifierQueryNode.java
@@ -94,7 +94,7 @@ public class ModifierQueryNode extends QueryNodeImpl {
   public ModifierQueryNode(QueryNode query, Modifier mod) {
     if (query == null) {
       throw new QueryNodeError(new MessageImpl(
-          QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, "query", "null"));
+          QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, new Object[]{"query", "null"}));
     }
 
     allocate();
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/PhraseSlopQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/PhraseSlopQueryNode.java
index e68f90a..7e2684a 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/PhraseSlopQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/PhraseSlopQueryNode.java
@@ -40,7 +40,7 @@ public class PhraseSlopQueryNode extends QueryNodeImpl implements FieldableNode
       throws QueryNodeException {
     if (query == null) {
       throw new QueryNodeError(new MessageImpl(
-          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, "query", "null"));
+          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, new Object[]{"query", "null"}));
     }
 
     this.value = value;
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ProximityQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ProximityQueryNode.java
index c886d99..b8bdb8d 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ProximityQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/ProximityQueryNode.java
@@ -109,8 +109,8 @@ public class ProximityQueryNode extends BooleanQueryNode {
     if (type == Type.NUMBER) {
       if (distance <= 0) {
         throw new QueryNodeError(new MessageImpl(
-            QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, "distance",
-            distance));
+            QueryParserMessages.PARAMETER_VALUE_NOT_SUPPORTED, new Object[]{"distance",
+            distance}));
 
       } else {
         this.distance = distance;
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/SlopQueryNode.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/SlopQueryNode.java
index 516925c..8a47bb2 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/SlopQueryNode.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/core/nodes/SlopQueryNode.java
@@ -47,7 +47,7 @@ public class SlopQueryNode extends QueryNodeImpl implements FieldableNode {
   public SlopQueryNode(QueryNode query, int value) {
     if (query == null) {
       throw new QueryNodeError(new MessageImpl(
-          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, "query", "null"));
+          QueryParserMessages.NODE_ACTION_NOT_SUPPORTED, new Object[]{"query", "null"}));
     }
 
     this.value = value;
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/BooleanQueryNodeBuilder.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/BooleanQueryNodeBuilder.java
index bcd2c2f..3065c47 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/BooleanQueryNodeBuilder.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/BooleanQueryNodeBuilder.java
@@ -67,9 +67,9 @@ public class BooleanQueryNodeBuilder implements StandardQueryBuilder {
           } catch (TooManyClauses ex) {
 
             throw new QueryNodeException(new MessageImpl(
-                QueryParserMessages.TOO_MANY_BOOLEAN_CLAUSES, BooleanQuery
+                QueryParserMessages.TOO_MANY_BOOLEAN_CLAUSES, new Object[]{BooleanQuery
                     .getMaxClauseCount(), queryNode
-                    .toQueryString(new EscapeQuerySyntaxImpl())), ex);
+                    .toQueryString(new EscapeQuerySyntaxImpl())}), ex);
 
           }
 
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchAllDocsQueryNodeBuilder.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchAllDocsQueryNodeBuilder.java
index 3b4cdb2..090b7c1 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchAllDocsQueryNodeBuilder.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchAllDocsQueryNodeBuilder.java
@@ -40,9 +40,9 @@ public class MatchAllDocsQueryNodeBuilder implements StandardQueryBuilder {
     // validates node
     if (!(queryNode instanceof MatchAllDocsQueryNode)) {
       throw new QueryNodeException(new MessageImpl(
-          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, queryNode
+          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, new Object[]{queryNode
               .toQueryString(new EscapeQuerySyntaxImpl()), queryNode.getClass()
-              .getName()));
+              .getName()}));
     }
 
     return new MatchAllDocsQuery();
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchNoDocsQueryNodeBuilder.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchNoDocsQueryNodeBuilder.java
index fb2c95c..653f270 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchNoDocsQueryNodeBuilder.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/MatchNoDocsQueryNodeBuilder.java
@@ -40,9 +40,9 @@ public class MatchNoDocsQueryNodeBuilder implements StandardQueryBuilder {
     // validates node
     if (!(queryNode instanceof MatchNoDocsQueryNode)) {
       throw new QueryNodeException(new MessageImpl(
-          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, queryNode
+          QueryParserMessages.LUCENE_QUERY_CONVERSION_ERROR, new Object[]{queryNode
               .toQueryString(new EscapeQuerySyntaxImpl()), queryNode.getClass()
-              .getName()));
+              .getName()}));
     }
 
     return new BooleanQuery();
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/StandardBooleanQueryNodeBuilder.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/StandardBooleanQueryNodeBuilder.java
index 3127286..f432ffa 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/StandardBooleanQueryNodeBuilder.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/builders/StandardBooleanQueryNodeBuilder.java
@@ -68,9 +68,9 @@ public class StandardBooleanQueryNodeBuilder implements StandardQueryBuilder {
           } catch (TooManyClauses ex) {
 
             throw new QueryNodeException(new MessageImpl(
-                QueryParserMessages.TOO_MANY_BOOLEAN_CLAUSES, BooleanQuery
+                QueryParserMessages.TOO_MANY_BOOLEAN_CLAUSES, new Object[]{BooleanQuery
                     .getMaxClauseCount(), queryNode
-                    .toQueryString(new EscapeQuerySyntaxImpl())), ex);
+                    .toQueryString(new EscapeQuerySyntaxImpl())}), ex);
 
           }
 
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/EscapeQuerySyntaxImpl.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/EscapeQuerySyntaxImpl.java
index 5288502..5cfb99b 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/EscapeQuerySyntaxImpl.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/EscapeQuerySyntaxImpl.java
@@ -289,7 +289,7 @@ public class EscapeQuerySyntaxImpl implements EscapeQuerySyntax {
       return c - 'A' + 10;
     } else {
       throw new ParseException(new MessageImpl(
-          QueryParserMessages.INVALID_SYNTAX_ESCAPE_NONE_HEX_UNICODE, c));
+          QueryParserMessages.INVALID_SYNTAX_ESCAPE_NONE_HEX_UNICODE, new Object[]{c}));
     }
   }
 
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/ParseException.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/ParseException.java
index 4664090..364b01b 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/ParseException.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/ParseException.java
@@ -47,8 +47,8 @@ public class ParseException extends QueryNodeParseException {
    */
   public ParseException(Token currentTokenVal,
       int[][] expectedTokenSequencesVal, String[] tokenImageVal) {
-    super(new MessageImpl(QueryParserMessages.INVALID_SYNTAX, initialise(
-        currentTokenVal, expectedTokenSequencesVal, tokenImageVal)));
+    super(new MessageImpl(QueryParserMessages.INVALID_SYNTAX, new Object[]{initialise(
+        currentTokenVal, expectedTokenSequencesVal, tokenImageVal)}));
     this.currentToken = currentTokenVal;
     this.expectedTokenSequences = expectedTokenSequencesVal;
     this.tokenImage = tokenImageVal;
@@ -59,7 +59,7 @@ public class ParseException extends QueryNodeParseException {
   }
 
   public ParseException() {
-    super(new MessageImpl(QueryParserMessages.INVALID_SYNTAX, "Error"));
+    super(new MessageImpl(QueryParserMessages.INVALID_SYNTAX, new Object[]{"Error"}));
   }
 
   /**
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/StandardSyntaxParser.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/StandardSyntaxParser.java
index fd6640c..ff3a00e 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/StandardSyntaxParser.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/parser/StandardSyntaxParser.java
@@ -68,7 +68,7 @@ public class StandardSyntaxParser implements SyntaxParser, StandardSyntaxParserC
             throw tme;
       }
       catch (Error tme) {
-          Message message = new MessageImpl(QueryParserMessages.INVALID_SYNTAX_CANNOT_PARSE, query, tme.getMessage());
+          Message message = new MessageImpl(QueryParserMessages.INVALID_SYNTAX_CANNOT_PARSE, new Object[]{query, tme.getMessage()});
           QueryNodeParseException e = new QueryNodeParseException(tme);
             e.setQuery(query);
             e.setNonLocalizedMessage(message);
diff --git a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/processors/AllowLeadingWildcardProcessor.java b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/processors/AllowLeadingWildcardProcessor.java
index 92c724b..1d78451 100644
--- a/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/processors/AllowLeadingWildcardProcessor.java
+++ b/contrib/queryparser/src/java/org/apache/lucene/queryParser/standard/processors/AllowLeadingWildcardProcessor.java
@@ -74,8 +74,8 @@ public class AllowLeadingWildcardProcessor extends QueryNodeProcessorImpl {
           case '*':
           case '?':
             throw new QueryNodeException(new MessageImpl(
-                QueryParserMessages.LEADING_WILDCARD_NOT_ALLOWED, node
-                    .toQueryString(new EscapeQuerySyntaxImpl())));    
+                QueryParserMessages.LEADING_WILDCARD_NOT_ALLOWED, new Object[]{node
+                    .toQueryString(new EscapeQuerySyntaxImpl())}));    
         }
       }
 
diff --git a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.java b/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.java
deleted file mode 100644
index d12b6d5..0000000
--- a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.java
+++ /dev/null
@@ -1,40 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements. See the NOTICE file distributed with this
- * work for additional information regarding copyright ownership. The ASF
- * licenses this file to You under the Apache License, Version 2.0 (the
- * "License"); you may not use this file except in compliance with the License.
- * You may obtain a copy of the License at
- * 
- * http://www.apache.org/licenses/LICENSE-2.0
- * 
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
- * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
- * License for the specific language governing permissions and limitations under
- * the License.
- */
-
-public class MessagesTestBundle extends NLS {
-
-  private static final String BUNDLE_NAME = MessagesTestBundle.class.getName();
-
-  private MessagesTestBundle() {
-    // should never be instantiated
-  }
-
-  static {
-    // register all string ids with NLS class and initialize static string
-    // values
-    NLS.initializeMessages(BUNDLE_NAME, MessagesTestBundle.class);
-  }
-
-  // static string must match the strings in the property files.
-  public static String Q0001E_INVALID_SYNTAX;
-  public static String Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION;
-
-  // this message is missing from the properties file
-  public static String Q0005E_MESSAGE_NOT_IN_BUNDLE;
-}
diff --git a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.properties b/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.properties
deleted file mode 100644
index 870ff73..0000000
--- a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle.properties
+++ /dev/null
@@ -1,3 +0,0 @@
-Q0001E_INVALID_SYNTAX = Syntax Error: {0}
-
-Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION = Truncated unicode escape sequence.
diff --git a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties b/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties
deleted file mode 100644
index 2235294..0000000
--- a/contrib/queryparser/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties
+++ /dev/null
@@ -1,3 +0,0 @@
-Q0001E_INVALID_SYNTAX = \u69cb\u6587\u30a8\u30e9\u30fc: {0}
-
-Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION = \u5207\u308a\u6368\u3066\u3089\u308c\u305f\u30e6\u30cb\u30b3\u30fc\u30c9\u30fb\u30a8\u30b9\u30b1\u30fc\u30d7\u30fb\u30b7\u30fc\u30b1\u30f3\u30b9\u3002
diff --git a/contrib/queryparser/src/test/org/apache/lucene/messages/TestNLS.java b/contrib/queryparser/src/test/org/apache/lucene/messages/TestNLS.java
deleted file mode 100644
index 35e35a9..0000000
--- a/contrib/queryparser/src/test/org/apache/lucene/messages/TestNLS.java
+++ /dev/null
@@ -1,81 +0,0 @@
-package org.apache.lucene.messages;
-
-/**
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *     http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-
-import java.util.Locale;
-
-import junit.framework.TestCase;
-
-/**
- */
-public class TestNLS extends TestCase {
-  public void testMessageLoading() {
-    Message invalidSyntax = new MessageImpl(
-        MessagesTestBundle.Q0001E_INVALID_SYNTAX, "XXX");
-    assertEquals("Syntax Error: XXX", invalidSyntax.getLocalizedMessage());
-  }
-
-  public void testMessageLoading_ja() {
-    Message invalidSyntax = new MessageImpl(
-        MessagesTestBundle.Q0001E_INVALID_SYNTAX, "XXX");
-    assertEquals("æ§???¨ã???: XXX", invalidSyntax
-        .getLocalizedMessage(Locale.JAPANESE));
-  }
-
-  public void testNLSLoading() {
-    String message = NLS
-        .getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION);
-    assertEquals("Truncated unicode escape sequence.", message);
-
-    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
-        "XXX");
-    assertEquals("Syntax Error: XXX", message);
-  }
-
-  public void testNLSLoading_ja() {
-    String message = NLS.getLocalizedMessage(
-        MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION,
-        Locale.JAPANESE);
-    assertEquals("????¨ã???????????¼ã??»ã??¹ã??¼ã??»ã??¼ã??³ã???", message);
-
-    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
-        Locale.JAPANESE, "XXX");
-    assertEquals("æ§???¨ã???: XXX", message);
-  }
-
-  public void testNLSLoading_xx_XX() {
-    Locale locale = new Locale("xx", "XX", "");
-    String message = NLS.getLocalizedMessage(
-        MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION,
-        locale);
-    assertEquals("Truncated unicode escape sequence.", message);
-
-    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
-        locale, "XXX");
-    assertEquals("Syntax Error: XXX", message);
-  }
-
-  public void testMissingMessage() {
-    Locale locale = Locale.ENGLISH;
-    String message = NLS.getLocalizedMessage(
-        MessagesTestBundle.Q0005E_MESSAGE_NOT_IN_BUNDLE, locale);
-
-    assertEquals("Message with key:Q0005E_MESSAGE_NOT_IN_BUNDLE and locale: "
-        + locale.toString() + " not found.", message);
-  }
-}
diff --git a/src/java/org/apache/lucene/messages/Message.java b/src/java/org/apache/lucene/messages/Message.java
new file mode 100644
index 0000000..f56f579
--- /dev/null
+++ b/src/java/org/apache/lucene/messages/Message.java
@@ -0,0 +1,37 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import java.io.Serializable;
+import java.util.Locale;
+
+/**
+ * Message Interface for a lazy loading.
+ * For Native Language Support (NLS), system of software internationalization.
+ */
+public interface Message extends Serializable {
+
+  public String getKey();
+
+  public Object[] getArguments();
+
+  public String getLocalizedMessage();
+
+  public String getLocalizedMessage(Locale locale);
+
+}
diff --git a/src/java/org/apache/lucene/messages/MessageImpl.java b/src/java/org/apache/lucene/messages/MessageImpl.java
new file mode 100644
index 0000000..14b3b50
--- /dev/null
+++ b/src/java/org/apache/lucene/messages/MessageImpl.java
@@ -0,0 +1,71 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import java.util.Locale;
+
+/**
+ * Default implementation of Message interface.
+ * For Native Language Support (NLS), system of software internationalization.
+ */
+public class MessageImpl implements Message {
+
+  private static final long serialVersionUID = -3077643314630884523L;
+
+  private String key;
+
+  private Object[] arguments = new Object[0];
+
+  public MessageImpl(String key) {
+    this.key = key;
+
+  }
+
+  public MessageImpl(String key, Object[] args) {
+    this(key);
+    this.arguments = args;
+  }
+
+  public Object[] getArguments() {
+    return this.arguments;
+  }
+
+  public String getKey() {
+    return this.key;
+  }
+
+  public String getLocalizedMessage() {
+    return getLocalizedMessage(Locale.getDefault());
+  }
+
+  public String getLocalizedMessage(Locale locale) {
+    return NLS.getLocalizedMessage(getKey(), locale, getArguments());
+  }
+
+  public String toString() {
+    Object[] args = getArguments();
+    String argsString = "";
+    if (args != null) {
+      for (int i = 0; i < args.length; i++) {
+        argsString += args[i] + (i < args.length ? "" : ", ");
+      }
+    }
+    return getKey() + " " + argsString;
+  }
+
+}
diff --git a/src/java/org/apache/lucene/messages/NLS.java b/src/java/org/apache/lucene/messages/NLS.java
new file mode 100644
index 0000000..97a727d
--- /dev/null
+++ b/src/java/org/apache/lucene/messages/NLS.java
@@ -0,0 +1,208 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import java.lang.reflect.Field;
+import java.lang.reflect.Modifier;
+import java.security.AccessController;
+import java.security.PrivilegedAction;
+import java.text.MessageFormat;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.Locale;
+import java.util.Map;
+import java.util.MissingResourceException;
+import java.util.ResourceBundle;
+
+/**
+ * MessageBundles classes extend this class, to implement a bundle.
+ * 
+ * For Native Language Support (NLS), system of software internationalization.
+ * 
+ * This interface is similar to the NLS class in eclipse.osgi.util.NLS class -
+ * initializeMessages() method resets the values of all static strings, should
+ * only be called by classes that extend from NLS (see TestMessages.java for
+ * reference) - performs validation of all message in a bundle, at class load
+ * time - performs per message validation at runtime - see NLSTest.java for
+ * usage reference
+ * 
+ * MessageBundle classes may subclass this type.
+ */
+public class NLS {
+
+  private static Map/*<String, Class<Object>>*/ bundles = new HashMap/*<String, Class<Object>>*/(
+      0);
+
+  protected NLS() {
+    // Do not instantiate
+  }
+
+  public static String getLocalizedMessage(String key) {
+    return getLocalizedMessage(key, Locale.getDefault());
+  }
+
+  public static String getLocalizedMessage(String key, Locale locale) {
+    Object message = getResourceBundleObject(key, locale);
+    if (message == null) {
+      return "Message with key:" + key + " and locale: " + locale
+          + " not found.";
+    }
+    return message.toString();
+  }
+
+  public static String getLocalizedMessage(String key, Locale locale,
+      Object[] args) {
+    String str = getLocalizedMessage(key, locale);
+
+    if (args.length > 0) {
+      str = MessageFormat.format(str, args);
+    }
+
+    return str;
+  }
+
+  public static String getLocalizedMessage(String key, Object[] args) {
+    return getLocalizedMessage(key, Locale.getDefault(), args);
+  }
+
+  /**
+   * Initialize a given class with the message bundle Keys Should be called from
+   * a class that extends NLS in a static block at class load time.
+   * 
+   * @param bundleName
+   *          Property file with that contains the message bundle
+   * @param clazz
+   *          where constants will reside
+   */
+  //@SuppressWarnings("unchecked")
+  protected static void initializeMessages(String bundleName, Class clazz) {
+    try {
+      load(clazz);
+      if (!bundles.containsKey(bundleName))
+        bundles.put(bundleName, clazz);
+    } catch (Throwable e) {
+      // ignore all errors and exceptions
+      // because this function is supposed to be called at class load time.
+    }
+  }
+
+  private static Object getResourceBundleObject(String messageKey, Locale locale) {
+
+    // slow resource checking
+    // need to loop thru all registered resource bundles
+    for (Iterator/*<String>*/ it = bundles.keySet().iterator(); it.hasNext();) {
+      Class/*<Object>*/ clazz = (Class) bundles.get((String)it.next());
+      ResourceBundle resourceBundle = ResourceBundle.getBundle(clazz.getName(),
+          locale);
+      if (resourceBundle != null) {
+        try {
+          Object obj = resourceBundle.getObject(messageKey);
+          if (obj != null)
+            return obj;
+        } catch (MissingResourceException e) {
+          // just continue it might be on the next resource bundle
+        }
+      }
+    }
+    // if resource is not found
+    return null;
+  }
+
+  /**
+   * @param clazz
+   */
+  private static void load(Class/*<Object>*/ clazz) {
+    final Field[] fieldArray = clazz.getDeclaredFields();
+
+    boolean isFieldAccessible = (clazz.getModifiers() & Modifier.PUBLIC) != 0;
+
+    // build a map of field names to Field objects
+    final int len = fieldArray.length;
+    Map/*<String, Field>*/ fields = new HashMap/*<String, Field>*/(len * 2);
+    for (int i = 0; i < len; i++) {
+      fields.put(fieldArray[i].getName(), fieldArray[i]);
+      loadfieldValue(fieldArray[i], isFieldAccessible, clazz);
+    }
+  }
+
+  /**
+   * @param field
+   * @param isFieldAccessible
+   */
+  private static void loadfieldValue(Field field, boolean isFieldAccessible,
+      Class/*<Object>*/ clazz) {
+    int MOD_EXPECTED = Modifier.PUBLIC | Modifier.STATIC;
+    int MOD_MASK = MOD_EXPECTED | Modifier.FINAL;
+    if ((field.getModifiers() & MOD_MASK) != MOD_EXPECTED)
+      return;
+
+    // Set a value for this empty field.
+    if (!isFieldAccessible)
+      makeAccessible(field);
+    try {
+      field.set(null, field.getName());
+      validateMessage(field.getName(), clazz);
+    } catch (IllegalArgumentException e) {
+      // should not happen
+    } catch (IllegalAccessException e) {
+      // should not happen
+    }
+  }
+
+  /**
+   * @param key
+   *          - Message Key
+   */
+  private static void validateMessage(String key, Class/*<Object>*/ clazz) {
+    // Test if the message is present in the resource bundle
+    try {
+      ResourceBundle resourceBundle = ResourceBundle.getBundle(clazz.getName(),
+          Locale.getDefault());
+      if (resourceBundle != null) {
+        Object obj = resourceBundle.getObject(key);
+        if (obj == null)
+          System.err.println("WARN: Message with key:" + key + " and locale: "
+              + Locale.getDefault() + " not found.");
+      }
+    } catch (MissingResourceException e) {
+      System.err.println("WARN: Message with key:" + key + " and locale: "
+          + Locale.getDefault() + " not found.");
+    } catch (Throwable e) {
+      // ignore all other errors and exceptions
+      // since this code is just a test to see if the message is present on the
+      // system
+    }
+  }
+
+  /*
+   * Make a class field accessible
+   */
+  //@SuppressWarnings("unchecked")
+  private static void makeAccessible(final Field field) {
+    if (System.getSecurityManager() == null) {
+      field.setAccessible(true);
+    } else {
+      AccessController.doPrivileged(new PrivilegedAction() {
+        public Object run() {
+          field.setAccessible(true);
+          return null;
+        }
+      });
+    }
+  }
+}
diff --git a/src/java/org/apache/lucene/messages/NLSException.java b/src/java/org/apache/lucene/messages/NLSException.java
new file mode 100644
index 0000000..0c6b904
--- /dev/null
+++ b/src/java/org/apache/lucene/messages/NLSException.java
@@ -0,0 +1,34 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+/**
+ * Interface that exceptions should implement to support lazy loading of messages.
+ * 
+ * For Native Language Support (NLS), system of software internationalization.
+ * 
+ * This Interface should be implemented by all exceptions that require
+ * translation
+ * 
+ */
+public interface NLSException {
+  /**
+   * @return a instance of a class that implements the Message interface
+   */
+  public Message getMessageObject();
+}
diff --git a/src/java/org/apache/lucene/messages/package.html b/src/java/org/apache/lucene/messages/package.html
new file mode 100644
index 0000000..14219e8
--- /dev/null
+++ b/src/java/org/apache/lucene/messages/package.html
@@ -0,0 +1,99 @@
+<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
+<!--
+ Licensed to the Apache Software Foundation (ASF) under one or more
+ contributor license agreements.  See the NOTICE file distributed with
+ this work for additional information regarding copyright ownership.
+ The ASF licenses this file to You under the Apache License, Version 2.0
+ (the "License"); you may not use this file except in compliance with
+ the License.  You may obtain a copy of the License at
+
+     http://www.apache.org/licenses/LICENSE-2.0
+
+ Unless required by applicable law or agreed to in writing, software
+ distributed under the License is distributed on an "AS IS" BASIS,
+ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ See the License for the specific language governing permissions and
+ limitations under the License.
+-->
+<html>
+<head>
+   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
+</head>
+<body>
+
+For Native Language Support (NLS), system of software internationalization.
+
+<h2>NLS message API</h2>
+<p>
+This utility API, adds support for NLS messages in the apache code.
+It is currently used by the lucene "New Flexible Query PArser".
+</p>
+<p>
+Features:
+    <ol>
+        <li>Message reference in the code, using static Strings</li>
+        <li>Message resource validation at class load time, for easier debugging</li>
+        <li>Allows for message IDs to be re-factored using eclipse or other code re-factor tools</li>
+        <li>Allows for reference count on messages, just like code</li>
+		<li>Lazy loading of Message Strings</li>        
+        <li>Normal loading Message Strings</li>                  
+    </ol>
+</p>
+
+<br/>
+<br/>
+<p>
+Lazy loading of Message Strings
+
+<pre>
+	public class MessagesTestBundle extends NLS {
+	
+	  private static final String BUNDLE_NAME = MessagesTestBundle.class.getName();
+	
+	  private MessagesTestBundle() {
+	    // should never be instantiated
+	  }
+	
+	  static {
+	    // register all string ids with NLS class and initialize static string
+	    // values
+	    NLS.initializeMessages(BUNDLE_NAME, MessagesTestBundle.class);
+	  }
+	
+	  // static string must match the strings in the property files.
+	  public static String Q0001E_INVALID_SYNTAX;
+	  public static String Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION;
+	
+	  // this message is missing from the properties file
+	  public static String Q0005E_MESSAGE_NOT_IN_BUNDLE;
+	}
+
+    // Create a message reference
+    Message invalidSyntax = new MessageImpl(MessagesTestBundle.Q0001E_INVALID_SYNTAX, "XXX");
+    
+    // Do other stuff in the code...
+    // when is time to display the message to the user or log the message on a file
+    // the message is loaded from the correct bundle
+    
+    String message1 = invalidSyntax.getLocalizedMessage();
+    String message2 = invalidSyntax.getLocalizedMessage(Locale.JAPANESE);
+</pre>
+</p>
+
+<br/>
+<br/>
+<p>
+Normal loading of Message Strings
+
+<pre>
+	String message1 = NLS.getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION);
+	String message2 = NLS.getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION, Locale.JAPANESE);
+</pre>
+</p>
+
+<p>
+The org.apache.lucene.messages.TestNLS junit contains several other examples.
+The TestNLS java code is available from the Apache Lucene code repository.
+</p>
+</body>
+</html>
diff --git a/src/test/org/apache/lucene/messages/MessagesTestBundle.java b/src/test/org/apache/lucene/messages/MessagesTestBundle.java
new file mode 100644
index 0000000..d12b6d5
--- /dev/null
+++ b/src/test/org/apache/lucene/messages/MessagesTestBundle.java
@@ -0,0 +1,40 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with this
+ * work for additional information regarding copyright ownership. The ASF
+ * licenses this file to You under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ * 
+ * http://www.apache.org/licenses/LICENSE-2.0
+ * 
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
+ * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
+ * License for the specific language governing permissions and limitations under
+ * the License.
+ */
+
+public class MessagesTestBundle extends NLS {
+
+  private static final String BUNDLE_NAME = MessagesTestBundle.class.getName();
+
+  private MessagesTestBundle() {
+    // should never be instantiated
+  }
+
+  static {
+    // register all string ids with NLS class and initialize static string
+    // values
+    NLS.initializeMessages(BUNDLE_NAME, MessagesTestBundle.class);
+  }
+
+  // static string must match the strings in the property files.
+  public static String Q0001E_INVALID_SYNTAX;
+  public static String Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION;
+
+  // this message is missing from the properties file
+  public static String Q0005E_MESSAGE_NOT_IN_BUNDLE;
+}
diff --git a/src/test/org/apache/lucene/messages/MessagesTestBundle.properties b/src/test/org/apache/lucene/messages/MessagesTestBundle.properties
new file mode 100644
index 0000000..870ff73
--- /dev/null
+++ b/src/test/org/apache/lucene/messages/MessagesTestBundle.properties
@@ -0,0 +1,3 @@
+Q0001E_INVALID_SYNTAX = Syntax Error: {0}
+
+Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION = Truncated unicode escape sequence.
diff --git a/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties b/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties
new file mode 100644
index 0000000..2235294
--- /dev/null
+++ b/src/test/org/apache/lucene/messages/MessagesTestBundle_ja.properties
@@ -0,0 +1,3 @@
+Q0001E_INVALID_SYNTAX = \u69cb\u6587\u30a8\u30e9\u30fc: {0}
+
+Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION = \u5207\u308a\u6368\u3066\u3089\u308c\u305f\u30e6\u30cb\u30b3\u30fc\u30c9\u30fb\u30a8\u30b9\u30b1\u30fc\u30d7\u30fb\u30b7\u30fc\u30b1\u30f3\u30b9\u3002
diff --git a/src/test/org/apache/lucene/messages/TestNLS.java b/src/test/org/apache/lucene/messages/TestNLS.java
new file mode 100644
index 0000000..97a14eb
--- /dev/null
+++ b/src/test/org/apache/lucene/messages/TestNLS.java
@@ -0,0 +1,81 @@
+package org.apache.lucene.messages;
+
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+import java.util.Locale;
+
+import junit.framework.TestCase;
+
+/**
+ */
+public class TestNLS extends TestCase {
+  public void testMessageLoading() {
+    Message invalidSyntax = new MessageImpl(
+        MessagesTestBundle.Q0001E_INVALID_SYNTAX, new Object[]{"XXX"});
+    assertEquals("Syntax Error: XXX", invalidSyntax.getLocalizedMessage());
+  }
+
+  public void testMessageLoading_ja() {
+    Message invalidSyntax = new MessageImpl(
+        MessagesTestBundle.Q0001E_INVALID_SYNTAX, new Object[]{"XXX"});
+    assertEquals("æ§???¨ã???: XXX", invalidSyntax
+        .getLocalizedMessage(Locale.JAPANESE));
+  }
+
+  public void testNLSLoading() {
+    String message = NLS
+        .getLocalizedMessage(MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION);
+    assertEquals("Truncated unicode escape sequence.", message);
+
+    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
+        new Object[]{"XXX"});
+    assertEquals("Syntax Error: XXX", message);
+  }
+
+  public void testNLSLoading_ja() {
+    String message = NLS.getLocalizedMessage(
+        MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION,
+        Locale.JAPANESE);
+    assertEquals("????¨ã???????????¼ã??»ã??¹ã??¼ã??»ã??¼ã??³ã???", message);
+
+    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
+        Locale.JAPANESE, new Object[]{"XXX"});
+    assertEquals("æ§???¨ã???: XXX", message);
+  }
+
+  public void testNLSLoading_xx_XX() {
+    Locale locale = new Locale("xx", "XX", "");
+    String message = NLS.getLocalizedMessage(
+        MessagesTestBundle.Q0004E_INVALID_SYNTAX_ESCAPE_UNICODE_TRUNCATION,
+        locale);
+    assertEquals("Truncated unicode escape sequence.", message);
+
+    message = NLS.getLocalizedMessage(MessagesTestBundle.Q0001E_INVALID_SYNTAX,
+        locale, new Object[]{"XXX"});
+    assertEquals("Syntax Error: XXX", message);
+  }
+
+  public void testMissingMessage() {
+    Locale locale = Locale.ENGLISH;
+    String message = NLS.getLocalizedMessage(
+        MessagesTestBundle.Q0005E_MESSAGE_NOT_IN_BUNDLE, locale);
+
+    assertEquals("Message with key:Q0005E_MESSAGE_NOT_IN_BUNDLE and locale: "
+        + locale.toString() + " not found.", message);
+  }
+}

